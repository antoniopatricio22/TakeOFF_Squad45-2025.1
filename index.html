<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Banco do Brasil</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Estilo personalizado -->
     <link rel="stylesheet" href="styles.css">
     <link rel="preload" href="BancoDoBrasilTextos-Regular.woff2" as="font" type="font/woff2" crossorigin>
</head>
<body>
    <header>
        <div class="header-container">
            <img src="./img/Banco-do-Brasil-logo.png" alt="Banco do Brasil" class="logo">
        </div>
    </header>
    <div class="login-container">
        <!-- Card de Login -->
        <div class="card">
            <h4 class="mb-1">Login</h4>
            <p class="text-muted mb-4">Acesse sua conta</p>
            <!-- Formulário de Login -->
            <form id="loginForm">
                <div class="mb-3">
                    <select class="form-select" id="tipoUsuario" required>
                        <option value="" disabled selected>Tipo de Usuário *</option>
                        <option value="admin">Administrador</option>
                        <option value="proprietario">Proprietário</option>
                    </select>
                </div>
                <div class="mb-3">
                    <input type="email" class="form-control" id="email" placeholder="E-mail *" required>
                </div>
                <div class="mb-3">
                    <input type="password" class="form-control" id="senha" placeholder="Senha *" required>
                </div>
                <button type="submit" class="btn btn-login">Entrar</button>
            </form>

            <!-- Esqueceu a senha -->
            <div class="mt-3">
                <a href="#" class="forgot-password">Esqueceu a senha?</a>
            </div>
        </div>

        <!-- Cadastre-se -->
        <div class="mt-3">
            <a href="cadastro_proprietario.html" class="signup">Clique aqui para fazer o seu cadastro!</a>
        </div>
    </div>

    <!-- Modal para exibir mensagens -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messageModalLabel">Mensagem</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body" id="messageModalBody">
                    <!-- Conteúdo da mensagem será inserido aqui -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS e Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            handleLogin();
        });

        async function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('senha').value;
            
            try {
                const response = await fetch('https://tempe.onrender.com/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    // Armazenar token e dados do usuário
                    localStorage.setItem('authToken', result.data.token);
                    localStorage.setItem('userData', JSON.stringify(result.data.usuario));
                    
                    showModal('Sucesso', 'Login realizado com sucesso!');
                    
                    // Redirecionar conforme o tipo de usuário
                    setTimeout(() => {
                        // Aqui você pode redirecionar para página específica baseada no tipo de usuário
                        if (result.data.usuario.role === 'ADMINISTRADOR') {
                            // Redirecionar para página admin
                            // window.location.href = "admin_dashboard.html";
                            showModal('Redirecionamento', 'Redirecionando para página de administrador...');
                        } else if (result.data.usuario.role === 'PROPRIETARIO') {
                            // Redirecionar para página proprietário
                            // window.location.href = "proprietario_dashboard.html";
                            showModal('Redirecionamento', 'Redirecionando para página de proprietário...');
                        }
                    }, 2000);
                } else {
                    showModal('Erro', result.error || 'Erro ao realizar login');
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                showModal('Erro', 'Erro ao conectar com o servidor. Verifique sua conexão.');
            }
        }
        
        function showModal(title, message) {
            document.getElementById('messageModalLabel').textContent = title;
            document.getElementById('messageModalBody').textContent = message;
            
            const messageModal = new bootstrap.Modal(document.getElementById('messageModal'));
            messageModal.show();
        }
    </script>
</body>
</html>